const _0x2e2f40=_0x3dd7;function _0x3dd7(_0x37d501,_0x20f8d8){const _0x2113c2=_0x2113();return _0x3dd7=function(_0x3dd71a,_0x3610dc){_0x3dd71a=_0x3dd71a-0xc3;let _0x3c969b=_0x2113c2[_0x3dd71a];return _0x3c969b;},_0x3dd7(_0x37d501,_0x20f8d8);}(function(_0x42b3b7,_0x2a660e){const _0x11a6c7=_0x3dd7,_0x309fe0=_0x42b3b7();while(!![]){try{const _0x3a06fe=-parseInt(_0x11a6c7(0xee))/0x1+parseInt(_0x11a6c7(0xea))/0x2*(parseInt(_0x11a6c7(0xfa))/0x3)+parseInt(_0x11a6c7(0xc6))/0x4+-parseInt(_0x11a6c7(0xd4))/0x5*(parseInt(_0x11a6c7(0xc4))/0x6)+parseInt(_0x11a6c7(0xd2))/0x7+parseInt(_0x11a6c7(0xca))/0x8*(parseInt(_0x11a6c7(0xf2))/0x9)+-parseInt(_0x11a6c7(0xdb))/0xa;if(_0x3a06fe===_0x2a660e)break;else _0x309fe0['push'](_0x309fe0['shift']());}catch(_0x5a1e89){_0x309fe0['push'](_0x309fe0['shift']());}}}(_0x2113,0x571cb));const {ethers}=require(_0x2e2f40(0xcb)),{getAllBalances,getFullBalance,InsufficientGasError}=require(_0x2e2f40(0xf9)),{stakeAllWbtc,stakeR2usd}=require(_0x2e2f40(0xe6)),{runSwapCycle,consolidateAssets}=require('./services/swap'),{addLiquidityWithRemaining}=require(_0x2e2f40(0xf8)),{colorText,COLORS}=require('./utils/dashboard'),{TOKENS,CONTRACTS}=require(_0x2e2f40(0xeb)),{LP_ABI}=require('./core/abi'),sleep=_0x1e11f7=>new Promise(_0x11d152=>setTimeout(_0x11d152,_0x1e11f7));async function refreshAndUpdate(_0x3a280a,_0x577562,_0x10b102={}){const _0x132a02=_0x2e2f40,_0x5d5b38=await getAllBalances(_0x3a280a);_0x577562['accountManager']['updateAccount'](_0x3a280a[_0x132a02(0xda)],{'balances':_0x5d5b38,..._0x10b102}),_0x577562[_0x132a02(0xc7)]();}async function runWithRetries(_0x1e597e,_0x1ca603,_0x559bee,_0x12bc57){const _0x1ce2b1=_0x2e2f40;while(!![]){try{_0x559bee[_0x1ce2b1(0xd6)][_0x1ce2b1(0xce)](_0x1ca603['address'],{'status':_0x1ce2b1(0xd0)+_0x12bc57}),await _0x1e597e(_0x1ca603,_0x559bee),_0x559bee[_0x1ce2b1(0xc3)](colorText(_0x12bc57+_0x1ce2b1(0xec),COLORS[_0x1ce2b1(0xd1)])),await refreshAndUpdate(_0x1ca603,_0x559bee);break;}catch(_0x48a23a){const _0x355a16=_0x48a23a[_0x1ce2b1(0xe5)][_0x1ce2b1(0xf6)]();if(_0x355a16[_0x1ce2b1(0xe7)](_0x1ce2b1(0xe3))||_0x355a16[_0x1ce2b1(0xe7)]('intrinsic\x20transaction\x20cost'))throw new InsufficientGasError(_0x1ce2b1(0xd3)+_0x12bc57+'.');_0x559bee[_0x1ce2b1(0xc3)](colorText(_0x12bc57+_0x1ce2b1(0xf4)+_0x48a23a[_0x1ce2b1(0xe5)][_0x1ce2b1(0xdc)](0x0,0x96)+_0x1ce2b1(0xc9),COLORS['RED'])),await refreshAndUpdate(_0x1ca603,_0x559bee),await sleep(0x2710);}}}function _0x2113(){const _0x4c5dd4=['R2USD','USDC\x20balance\x20is\x20too\x20low.\x20Checking\x20R2USD.','addLog','30KAoIgN','Stake\x20wBTC\x20process','1351248WSIEJL','render','\x20finished\x20successfully.','.\x20Retrying\x20in\x2010s...','40gkshhW','ethers','Asset\x20Consolidation\x20process','exports','updateAccount','balances','Processing:\x20','GREEN','4136860oNsFkX','Gas\x20too\x20low\x20during\x20','570715ezuEyB','Add\x20Liquidity\x20process','accountManager','CYAN','all','Contract','address','1972460kWIPJF','substring','Smart\x20Staking:\x20Staking\x20','decimals','floor','formatUnits','\x20but\x20only\x20have\x20','Balancing\x20for\x20Liquidity','insufficient\x20funds','Balances\x20are\x20already\x20ratio-optimized\x20or\x20have\x20excess\x20sR2USD.\x20No\x20staking\x20needed.','message','./services/stake','includes','toString','sR2USD','4786kmMzCL','./core/contracts','\x20successful.','LP\x20pool\x20is\x20empty.\x20Staking\x2050%\x20of\x20R2USD\x20as\x20a\x20fallback.','530490LZyoTg','Calculation\x20suggests\x20staking\x20','.\x20Staking\x2050%\x20as\x20fallback.','Process\x20Complete','467703jYZMYO','Swap\x20Cycle\x20process','\x20failed:\x20','R2\x20balance\x20is\x20too\x20low.\x20Skipping\x20swap\x20cycle,\x20proceeding\x20to\x20consolidation.','toLowerCase','YELLOW','./services/lp','./services/helper','585mMITyv'];_0x2113=function(){return _0x4c5dd4;};return _0x2113();}async function balanceAndProvideLiquidity(_0x2da464,_0x340743){const _0x2e4361=_0x2e2f40;_0x340743['accountManager'][_0x2e4361(0xce)](_0x2da464[_0x2e4361(0xda)],{'status':_0x2e4361(0xe2)});const _0xbd8244=parseFloat(await getFullBalance(_0x2da464,TOKENS[_0x2e4361(0xfb)]['address'])),_0x654eda=parseFloat(await getFullBalance(_0x2da464,TOKENS[_0x2e4361(0xe9)][_0x2e4361(0xda)]));if(_0xbd8244<0xa&&_0x654eda<0xa){_0x340743['addLog'](colorText('Skipping\x20LP\x20process:\x20R2USD\x20and\x20sR2USD\x20balances\x20are\x20too\x20low.',COLORS[_0x2e4361(0xf7)]));return;}const _0x144935=new ethers[(_0x2e4361(0xd9))](CONTRACTS['LP'],LP_ABI,_0x2da464['provider']),_0x1a5634=await Promise[_0x2e4361(0xd8)]([_0x144935[_0x2e4361(0xcf)](0x0),_0x144935[_0x2e4361(0xcf)](0x1)]),_0x178c46=parseFloat(ethers[_0x2e4361(0xe0)](_0x1a5634[0x0],TOKENS[_0x2e4361(0xe9)]['decimals'])),_0x2e215b=parseFloat(ethers[_0x2e4361(0xe0)](_0x1a5634[0x1],TOKENS[_0x2e4361(0xfb)][_0x2e4361(0xde)]));if(_0x2e215b>0x0){const _0x5cc196=_0x178c46/_0x2e215b,_0x4aba1d=(_0x5cc196*_0xbd8244-_0x654eda)/(0x1+_0x5cc196);if(_0x4aba1d>0x1&&_0x4aba1d<=_0xbd8244)_0x340743[_0x2e4361(0xc3)](colorText(_0x2e4361(0xdd)+Math['floor'](_0x4aba1d)+'\x20R2USD\x20to\x20match\x20LP\x20ratio.',COLORS[_0x2e4361(0xd7)])),await stakeR2usd(_0x2da464,Math[_0x2e4361(0xdf)](_0x4aba1d)['toString'](),_0x340743),await refreshAndUpdate(_0x2da464,_0x340743);else{if(_0x4aba1d<=0x1)_0x340743[_0x2e4361(0xc3)](colorText(_0x2e4361(0xe4),COLORS[_0x2e4361(0xd7)]));else{_0x340743[_0x2e4361(0xc3)](colorText(_0x2e4361(0xef)+Math[_0x2e4361(0xdf)](_0x4aba1d)+_0x2e4361(0xe1)+Math[_0x2e4361(0xdf)](_0xbd8244)+_0x2e4361(0xf0),COLORS['YELLOW']));const _0x56dcef=Math[_0x2e4361(0xdf)](_0xbd8244/0x2);_0x56dcef>0x0&&(await stakeR2usd(_0x2da464,_0x56dcef[_0x2e4361(0xe8)](),_0x340743),await refreshAndUpdate(_0x2da464,_0x340743));}}}else{_0x340743[_0x2e4361(0xc3)](colorText(_0x2e4361(0xed),COLORS[_0x2e4361(0xf7)]));const _0x5e10a4=Math[_0x2e4361(0xdf)](_0xbd8244/0x2);_0x5e10a4>0x64&&(await stakeR2usd(_0x2da464,_0x5e10a4['toString'](),_0x340743),await refreshAndUpdate(_0x2da464,_0x340743));}await addLiquidityWithRemaining(_0x2da464,_0x340743);}async function runProcess(_0x30b12e,_0x3164cf){const _0x23618f=_0x2e2f40;await runWithRetries(stakeAllWbtc,_0x30b12e,_0x3164cf,_0x23618f(0xc5));const _0x37c033=await getAllBalances(_0x30b12e);parseFloat(_0x37c033['USDC'])<0x1?(_0x3164cf[_0x23618f(0xc3)](colorText(_0x23618f(0xfc),COLORS['YELLOW'])),parseFloat(_0x37c033[_0x23618f(0xfb)])<0x44c&&(_0x3164cf[_0x23618f(0xc3)](colorText('R2USD\x20balance\x20is\x20too\x20low.\x20Checking\x20R2.',COLORS['YELLOW'])),parseFloat(_0x37c033['R2'])<0x2710&&(_0x3164cf['addLog'](colorText(_0x23618f(0xf5),COLORS[_0x23618f(0xf7)])),await runWithRetries(consolidateAssets,_0x30b12e,_0x3164cf,_0x23618f(0xcc))))):(await runWithRetries(runSwapCycle,_0x30b12e,_0x3164cf,_0x23618f(0xf3)),await runWithRetries(consolidateAssets,_0x30b12e,_0x3164cf,'Asset\x20Consolidation\x20process')),await refreshAndUpdate(_0x30b12e,_0x3164cf),await runWithRetries(balanceAndProvideLiquidity,_0x30b12e,_0x3164cf,_0x23618f(0xd5)),_0x3164cf['accountManager'][_0x23618f(0xce)](_0x30b12e[_0x23618f(0xda)],{'status':_0x23618f(0xf1)}),_0x3164cf['addLog'](colorText('Account\x20'+_0x30b12e['address']+_0x23618f(0xc8),COLORS[_0x23618f(0xd1)]));}module[_0x2e2f40(0xcd)]={'runProcess':runProcess};